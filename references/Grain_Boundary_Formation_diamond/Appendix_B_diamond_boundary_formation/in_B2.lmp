#------------------------------------------------------------------------------------------
# Appendix B
# LAMMPS scripts for diamond boundary formation
# 
# B.2 Adding atomic disorder near boundaries
# This example script uses an input file with the original atomic configuration near
# the Simga19 tilt boundary, which is not included. However, it should not be difficult
# to generate an input file for the Sigma9 boundary from the output of the above script,
# and modify this script to work with it; the input file needs to have the format
# shown in Section A.2. Note that the exact atomic arrangement generated by this
# script depends on the machine, and on the number of parallel processors used. The
# divergence of the atomic trajectories predicted by two different machines is thought
# to originate from rounding errors.
#------------------------------------------------------------------------------------------
# LAMMPS 64-bit 22Dec2022-MSMPI
#------------------------------------------------------------------------------------------
variable csl_name string s19m11
variable name_full string Diamond_ftb_distort
variable data_filename string Diamond_interface_s19_ftb.dat

log ${name_full}.log

units metal
atom_style atomic

boundary p p p
read_data ${data_filename}

mass 1 12.0

pair_style tersoff
pair_coeff * * SiC.tersoff C

timestep 0.00025 # 0.25 [fs]

compute temp interface temp

thermo 100
thermo_style custom step temp pe etotal press vol c_temp

#remove about 10% of atoms within 3 Ang of interface located at z=15.46

region interface block INF INF INF INF 12.46 18.46 units box
delete_atoms porosity interface 0.095 842514
group interface region interface

dump progress all atom 1000 ${name_full}.lammpstrj
dump_modify progress sort id

#melt

fix 1 interface nve
velocity interface create 40000.0 4928459 dist gaussian
run 10000

#cool down

fix 2 interface viscous 0.0005
run 40000
unfix 2

timestep 0.001 # 1 [fs]

fix 2 interface viscous 0.002
run 5000
unfix 2
unfix 1

#output interface with first orientation

dump forw_to_back all atom 10 &
  dump/${csl_name}_forw_to_back.lammpstrj
dump_modify forw_to_back sort id
dump forw_to_back_pos all custom 10 &
  dump/${csl_name}_forw_to_back.txt id type x y z
dump_modify forw_to_back_pos sort id

run 0

undump forw_to_back
undump forw_to_back_pos

#move/rotate to obtain second orientation by ’reflection’

displace_atoms all move -1.26126 -1.175594 0.0 units box
displace_atoms all rotate 0.0 5.525 25.0 1.0 0.0 0.0 180.0 units box

dump back_to_forw all atom 10 &
  dump/${csl_name}_back_to_forw.lammpstrj
dump_modify back_to_forw sort id
dump back_to_forw_pos all custom 10 &
  dump/${csl_name}_back_to_forw.txt id type x y z
dump_modify back_to_forw_pos sort id

run 0
#------------------------------------------------------------------------------------------