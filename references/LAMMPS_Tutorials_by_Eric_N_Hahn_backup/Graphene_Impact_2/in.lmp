#-----------------------------------------------------------------------------------------
### Created by Eric N. Hahn  ###
### ericnhahn@gmail.com ###
### Diamond impact of graphene sheets ###
### Version 0.4 ###
#-----------------------------------------------------------------------------------------

#------------------ Setup the simulation -------------------------

variable name Graphene_impact_0.4

log log.${name}
echo screen
dimension  3
units           metal
atom_style      atomic
boundary p p p

lattice custom 2.4205 a1 1  0  0  a2 0 1.73203 0 &
 basis 0 0 0  &
 basis 0.5 0.16666666666666666 0 &
 basis 0.5 0.5 0 &
 basis 0 0.6666666666666666 0
region box block  -77 77 -44 44 -5 100 units lattice
create_box 1 box

region graphene block  -77 77 -44 44 0 0.1 units lattice
create_atoms 1 region graphene 

region graphene2 block -77 77 -44 44 8 8.1 units lattice
create_atoms 1 region graphene2 

lattice diamond 3.567
region mobile sphere 0 0 150 24 units box
create_atoms 1 region mobile
group impactor region mobile

mass * 12.011

#-------------- Define Interatomic Potential -------------------
pair_style airebo/morse 3.0
pair_coeff * * CH.airebo-m C

compute 3 all pe/atom
compute 4 all stress/atom NULL virial #note, ignores thermal contribution to stress

#------------- Run the simulation for equilibration -------------
thermo  5
thermo_style custom step pe ke etotal temp lx ly lz press atoms

minimize 1.0e-10 1.0e-10 50 50
fix smaller all box/relax aniso 0.0
velocity all create 300.0 12345 dist gaussian
fix npt all npt temp 298 298 .5 x 0.0 0.0 .5 y 0.0 0.0 .5

dump eve all custom 5 dump.graphene_impact_new2020_min.* id type x y z vx vy vz c_3 fz c_4[1] c_4[2] c_4[3]

timestep 0.001

fix bp all balance 250 1 shift z 10 1
run 10

minimize 1.0e-4 1.0e-6 10 10
velocity all create 450.0 123456 dist gaussian
run 10

minimize 1.0e-4 1.0e-6 10 10
velocity all create 450.0 1234567 dist gaussian
run 10

minimize 1.0e-4 1.0e-6 10 10
unfix smaller
velocity all create 450.0 12345678 dist gaussian
run 50

group graphene1 region graphene
group graphene2 region graphene2
group graphene union graphene1 graphene2

variable ymn equal ylo+4
variable ymx equal yhi-4
variable xmn equal xlo+4
variable xmx equal xhi-4

region middle block ${xmn} ${xmx} ${ymn} ${ymx} -5 20 units box
group middle region middle
group edge subtract graphene middle
unfix npt

change_box all boundary p p s

#------------- Run the simulation for impact --------------

reset_timestep 0
velocity edge set 0 0 0 sum no units box
fix sheet edge setforce 0 0 0.0
velocity impactor set 0.0 0.0 -50.0 sum yes units box   #20 A/ps = 2 km/s
undump eve
dump eve all custom 2 dump.${name}.* id type x y z vx vy vz c_3 fz c_4[1] c_4[2] c_4[3]

fix nve all nve
timestep 0.001
run 40000

print "Job's done"
#-----------------------------------------------------------------------------------------